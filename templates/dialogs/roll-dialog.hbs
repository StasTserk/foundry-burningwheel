<form class="dialog">
    <h2>{{name}}</h2>
    {{#if showObstacles}}
    <div class="flex-row">
        <hr class="dialog-section-before"><div class="dialog-section-text">{{localize "BW.obstacle"}}</div><hr class="dialog-section-after">
        {{#if showDifficulty}}
        <div class="flex-row dialog-row">
            <label>{{localize "BW.roll.difficulty"}}</label>
            <input type="number" class="exponent" name="difficulty" value="{{difficulty}}">
        </div>
        {{/if}}
        {{#if obPenalty}}
        <div class="flex-row dialog-row">
            <label>{{localize "BW.roll.woundPenalty"}}</label>
            <input type="number" class="exponent" disabled name="obPenalty" value="{{obPenalty}}">
        </div>
        {{/if}}
        {{#each obModifiers as |mod|}}
        <div class="flex-row dialog-row">
            <label>{{mod.label}}</label>
            <input type="checkbox" class="hidden" name="miscObs" checked value="{{mod.obstacle}}" data-name="{{mod.label}}">
            <input type="number" class="exponent" disabled value="{{mod.obstacle}}" data-name="{{mod.label}}">
        </div>
        {{/each}}
    </div>
    {{/if}}
    <div class="flex-row">
        <hr class="dialog-section-before"><div class="dialog-section-text">{{localize "BW.dice"}}</div><hr class="dialog-section-after">
        <div class="flex-row dialog-row">
            <label>{{localize "BW.roll.exponent"}}</label>
            {{#if skill}}
            <input type="number" class="exponent" disabled name="skill.exp" value="{{skill.exp}}">
            {{/if}}
            {{#if stat}}
            <input type="number" class="exponent" disabled name="stat.exp" value="{{stat.exp}}">
            {{/if}}
        </div>
        {{#if tax}}
        <div class="flex-row dialog-row">
            <label>{{localize "BW.tax"}}</label>
            <input type="number" class="exponent" disabled name="tax" value="{{tax}}">
        </div>
        {{/if}}
        {{#if woundDice}}
        <div class="flex-row dialog-row">
            <label>{{localize "BW.roll.woundPenalty"}}</label>
            <input type="number" class="exponent" disabled name="woundDice" value="{{woundDice}}">
        </div>
        {{/if}}
            {{#if circlesContact}}
        <div class="flex-row dialog-row">
            <label>{{localize "BW.roll.relationshipBonus"}}</label>
            <input type="number" class="exponent" disabled value="1">
        </div>
        {{/if}}
        {{#each diceModifiers as |mod|}}
        <div class="flex-row dialog-row">
            <label>{{mod.label}}</label>
            <input type="checkbox" class="hidden" name="miscDice" checked value="{{mod.dice}}" data-name="{{mod.label}}">
            <input type="number" class="exponent" disabled value="{{mod.dice}}" data-name="{{mod.label}}">
        </div>
        {{/each}}
        <div class="flex-row dialog-row">
            <label>{{localize "BW.roll.bonusDice"}}</label>
            <input type="number" class="exponent" name="bonusDice" value="{{bonusDice}}">
        </div>
        {{#if cashDieOptions}}
        <div class="flex-row dialog-row">
            <label>{{localize "BW.roll.cashDice"}}</label>
            <select name="cashDice">
                {{#select cashDice}}
                <option value="0">0</option>
                {{#each cashDieOptions as |o|}}
                <option value="{{plusone o 1}}">{{plusone o 1}}</option>
                {{/each}}
                {{/select}}
            </select>
        </div>
        {{/if}}
        {{#if fundDieOptions}}
        <div class="flex-row dialog-row">
            <label>{{localize "BW.roll.fundDice"}}</label>
            <select name="fundDice">
                {{#select fundDice}}
                <option value="0">0</option>
                {{#each fundDieOptions as |o|}}
                <option value="{{plusone o 1}}">{{plusone o 1}}</option>
                {{/each}}
                {{/select}}
            </select>
        </div>
        {{/if}}
        <div class="flex-row dialog-row">
            <label for="checkbox-add-help">{{localize "BW.roll.acceptHelp"}}</label>
            <input id="checkbox-add-help" type="checkbox" name="acceptHelp" value="1">
        </div>
    </div>
    <div class="flex-row">
        <hr class="dialog-section-before"><div class="dialog-section-text">{{localize "BW.roll.arthaDice"}}</div><hr class="dialog-section-after">
        {{#if personaOptions}}
        <div class="flex-row dialog-row">
            <label>{{localize "BW.roll.personaDice"}}</label>
            <select name="personaDice">
                {{#select personaDice}}
                <option value="0">0</option>
                {{#each personaOptions as |o|}}
                <option value="{{plusone o 1}}">{{plusone o 1}}</option>
                {{/each}}
                {{/select}}
            </select>
        </div>
        {{/if}}
        {{#if deedsPoint}}
        <div class="flex-row dialog-row">
            <label for="checkbox-inspiration">{{localize "BW.roll.divineInspiration"}}</label>
            {{#if skill}}
            <input id="checkbox-inspiration" type="checkbox" name="deedsDice" value="{{skill.exp}}">
            {{/if}}
            {{#if stat}}
            <input id="checkbox-inspiration" type="checkbox" name="deedsDice" value="{{stat.exp}}">
            {{/if}}
        </div>
        {{/if}}
        <div class="flex-row dialog-row">
            <label>{{localize "BW.roll.miscArtha"}}</label>
            <input type="number" class="exponent" name="arthaDice" value="{{arthaDice}}">
        </div>
    </div>
    {{#if circlesBonus}}
    <div class="flex-row">
        <hr class="dialog-section-before"><div class="dialog-section-text">{{localize "BW.roll.repAndAff"}}</div><hr class="dialog-section-after">    
        <div class="checkbox-grid">
            {{#each circlesBonus as |b|}}
                <input id="checkbox-{{@key}}-{{slugify b.name}}" type="checkbox" name="circlesBonus" value="{{b.amount}}" data-name="{{b.name}}">
                <label for="checkbox-{{@key}}-{{slugify b.name}}">{{b.name}}</label>
            {{/each}}
        </div>
    </div>
    {{/if}}
    {{#if circlesMalus}}
    <div class="flex-row">
        <hr class="dialog-section-before"><div class="dialog-section-text">{{localize "BW.roll.infamies"}}</div><hr class="dialog-section-after">
        <div class="checkbox-grid">
            {{#each circlesMalus as |b|}}
                <input id="checkbox-{{@key}}-{{slugify b.name}}" type="checkbox" name="circlesMalus" value="{{b.amount}}" data-name="{{b.name}}">
                <label for="checkbox-{{@key}}-{{slugify b.name}}">{{b.name}}</label>
            {{/each}}
        </div>
    </div>
    {{/if}}
    {{#if offerSplitPool}}
    <div class="flex-row">
        <hr class="dialog-section-before"><div class="dialog-section-text">{{localize "BW.roll.secondaryPool"}}</div><hr class="dialog-section-after">
        <div class="flex-row dialog-row">
            <label>{{localize "BW.roll.secondaryPool"}}</label>
            <input type="number" class="exponent no-arrows" name="splitPool" value="0">
        </div>
        <div class="dialog-row">
            {{localize "BW.roll.secondaryPoolTooltip"}}
        </div>
    </div>
    {{/if}}
    {{#if forkOptions}}
    <div class="flex-row">
        <hr class="dialog-section-before"><div class="dialog-section-text">{{localize "BW.roll.forks"}}</div><hr class="dialog-section-after">
        <div class="checkbox-grid">
            {{#each forkOptions as |skill|}}
                <input id="checkbox-fork-{{@key}}" type="checkbox" name="forkOptions" value="{{skill.amount}}">
                <label for="checkbox-fork-{{@key}}">{{skill.name}}</label>
            {{/each}}
        </div>
    </div>
    {{/if}}
    {{#if wildForks}}
    <div class="flex-row">
        <hr class="dialog-section-before"><div class="dialog-section-text">{{localize "BW.roll.wildForks"}}</div><hr class="dialog-section-after">
        <div class="checkbox-grid">
            {{#each wildForks as |skill|}}
                <input id="checkbox-wild-{{@key}}" type="checkbox" name="wildForks" value="{{skill.amount}}">
                <label for="checkbox-wild-{{@key}}">{{skill.name}}</label>
            {{/each}}
        </div>
    </div>
    {{/if}}
    {{#if needsToolkit}}
    <div class="flex-row">
        <hr class="dialog-section-before"><div class="dialog-section-text">{{localize "BW.roll.tools"}}</div><hr class="dialog-section-after">
        <div class="flex-row dialog-row">
            <label for="checkbox-tool-penalty">{{localize "BW.roll.noToolPenalty"}}</label>
            <input id="checkbox-tool-penalty" type="checkbox" name="toolPenalty" value="1"> 
        </div>
        <div class="flex-row dialog-row">
            <label for="select-toolkit" name="toolkit">{{localize "BW.roll.expendToolkit"}}</label>
            <select id="select-toolkit" name="toolkitId">
                <option value="">{{localize "BW.none"}}</option>
                {{#each toolkits as |t|}}
                <option value="{{t._id}}">{{t.name}}{{#if t.system.isExpended}} ({{localize "BW.roll.expended"}}){{/if}}</option>
                {{/each}}
            </select>
        </div>
    </div>
    {{/if}}
    {{#if optionalDiceModifiers}}
    <div class="flex-row">
        <hr class="dialog-section-before"><div class="dialog-section-text">{{localize "BW.roll.optionalDiceMod"}}</div><hr class="dialog-section-after">
        <div class="checkbox-grid col-2">
            {{#each optionalDiceModifiers as |mod|}}
            <input id="checkbox-{{@key}}-die" type="checkbox" name="miscDice" value="{{mod.dice}}" data-name="{{mod.label}}">
            <label for="checkbox-{{@key}}-die">{{mod.label}}</label>
            {{/each}}
        </div>
    </div>
    {{/if}}

    {{#if optionalObModifiers}}
    <div class="flex-row">
        <hr class="dialog-section-before"><div class="dialog-section-text">{{localize "BW.roll.optionalObMod"}}</div><hr class="dialog-section-after">
        <div class="checkbox-grid col-2">
            {{#each optionalObModifiers as |mod|}}
            <input id="checkbox-{{@key}}-ob" type="checkbox" name="miscObs" value="{{mod.obstacle}}" data-name="{{mod.label}}">
            <label for="checkbox-{{@key}}-ob">{{mod.label}}</label>
            {{/each}}
        </div>
    </div>
    {{/if}}
    {{#if learning}} <input type="hidden" name="learning" value="1">{{/if}}
    {{#if useCustomDifficulty}}<input type="hidden" name="forceCustomDifficulty" value="1">{{/if}}
</form>