<form autocomplete="off" class="character">
    {{#if data.settings.showSettings}}
    {{> "systems/burningwheel/templates/parts/character-settings.html"}}
    {{/if}}
    <div class="character-header flex-row">
        <div class="portrait">
            <img class="profile" src="{{actor.img}}" title="{{actor.name}}" data-edit="img"/>
        </div>
        <div class="section-index item-grid col-2">
            <h2 class="section-header">Character Index
                <input id="{{actor._id}}-settings-checkbox" type="checkbox" class="hidden settings-checkbox" name="data.settings.showSettings" {{checked data.settings.showSettings}}>
                <label class="settings-gear" for="{{actor._id}}-settings-checkbox"><i class="fas fa-cogs"></i></label>
            </h2>
            <div>
                <label for="{{actor._id}}-character-name">Name</label>
                <input id="{{actor._id}}-character-name" type="text" name="name" value="{{actor.name}}">
            </div>
            <div>
                <label for="{{actor._id}}-character-stock">Stock</label>
                <input id="{{actor._id}}-character-stock" type="text" name="data.stock" value="{{data.stock}}">
            </div>
            <div>
                <label for="{{actor._id}}-character-age">Age</label>
                <input id="{{actor._id}}-character-age" type="number" name="data.age" value="{{data.age}}">
            </div>
            <div>
                <label for="{{actor._id}}-character-lifepaths">Lifepaths</label>
                <input id="{{actor._id}}-character-lifepaths" type="text" name="data.lifepathString" value="{{data.lifepathString}}">
            </div>
            <div>
                <label for="{{actor._id}}-character-alias">Alias</label>
                <input id="{{actor._id}}-character-alias" type="text" name="data.alias" value="{{data.alias}}">
            </div>
            <div>
                <label for="{{actor._id}}-character-homeland">Homeland</label>
                <input id="{{actor._id}}-character-homeland" type="text" name="data.homeland" value="{{data.homeland}}">
            </div>
            <div>
                <label for="{{actor._id}}-character-features">Features</label>
                <input id="{{actor._id}}-character-features" type="text" name="data.features" value="{{data.features}}">
            </div>
            <div class="flex-row artha-points">
                <div>
                    <label for="{{actor._id}}-character-fate-points" class="artha-label">Fate</label>
                    <input id="{{actor._id}}-character-fate-points" name="data.fate" value="{{data.fate}}" type="number" min="0" class="artha-input">
                </div>
                <div>
                    <label for="character-persona-points" class="artha-label">Persona</label>
                    <input id="character-persona-points" name="data.persona" value="{{data.persona}}" type="number" min="0" class="artha-input">
                </div>
                <div>
                    <label for="{{actor._id}}-character-deeds-points" class="artha-label">Deeds</label>
                    <input id="{{actor._id}}-character-deeds-points" name="data.deeds" value="{{data.deeds}}" type="number" min="0" class="artha-input">
                </div>
            </div>
        </div>
    </div>

    <input type="checkbox" id="{{actor._id}}-collapseBeliefs" name="data.collapseBeliefs" class="section-collapse beliefs-collapse" {{ checked data.collapseBeliefs }}>
    <label for="{{actor._id}}-collapseBeliefs" class="section-collapse-label">
        <h2 class="section-header"><i class="fas fa-chevron-down"></i>Beliefs</h2>
    </label>      
    <div class="beliefs">
        {{#each beliefs as |belief iid|}}
            <div class="bits-item flex-row">
                <div>
                    <div class="bits-item-name">{{belief.name}}</div>
                    F:<input type="checkbox" data-item-id="{{belief._id}}" data-binding="data.fate" {{ checked belief.data.fate }}>
                    P:<input type="checkbox" data-item-id="{{belief._id}}" data-binding="data.persona"  {{ checked belief.data.persona }}>
                    D:<input type="checkbox" data-item-id="{{belief._id}}" data-binding="data.deeds" {{ checked belief.data.deeds }}>
                </div>
                <textarea data-item-id="{{belief._id}}" data-binding="data.text" rows="1">{{belief.data.text}}</textarea>
            </div>
        {{/each}}
    </div>

    <input type="checkbox" id="{{actor._id}}-collapseInstincts" name="data.collapseInstincts" class="section-collapse instincts-collapse" {{ checked data.collapseInstincts }}>
    <label for="{{actor._id}}-collapseInstincts" class="section-collapse-label">
        <h2 class="section-header"><i class="fas fa-chevron-down"></i>Instincts</h2>
    </label>
    <div class="instincts">
        {{#each instincts as |instinct|}}
            <div class="bits-item flex-row">
                <div>
                <div class="bits-item-name">{{instinct.name}}</div>
                    F:<input type="checkbox" data-item-id="{{instinct._id}}" data-binding="data.fate" {{ checked instinct.data.fate }}>
                    P:<input type="checkbox" data-item-id="{{instinct._id}}" data-binding="data.persona"  {{ checked instinct.data.persona }}>
                    D:<input type="checkbox" data-item-id="{{instinct._id}}" data-binding="data.deeds" {{ checked instinct.data.deeds }}>
                </div>
                <textarea data-item-id="{{instinct._id}}" data-binding="data.text" rows="1">{{instinct.data.text}}</textarea>
            </div>
        {{/each}}
    </div>

    <input type="checkbox" id="{{actor._id}}-collapseTraits" name="data.collapseTraits" class="section-collapse traits-collapse" {{ checked data.collapseTraits }}>
    <label for="{{actor._id}}-collapseTraits" class="section-collapse-label">
        <h2 class="section-header"><i class="fas fa-chevron-down"></i>Traits</h2>
    </label>
    <div class="traits flex-row">
        <div class="trait-category">
            <h2>Character Traits
                <i data-action="addTrait" data-id="character" class="fas fa-plus"></i>
            </h2>
            {{#each traits.character as |trait|}}
                <div class="trait" data-item-id="{{trait._id}}">
                    <h3>
                        {{ trait.name }}
                        <i class="fas fa-trash" data-action="delItem" data-id="{{trait._id}}"></i>
                        <i class="fas fa-edit" data-action="editItem" data-id="{{trait._id}}"></i>
                    </h3>
                </div>
            {{/each}}
        </div>
        <div class="trait-category">
            <h2>Die Traits
                <i data-action="addTrait" data-id="die" class="fas fa-plus"></i>
            </h2>
            {{#each traits.die as |trait|}}
                <input type="checkbox" id={{trait._id}}-toggle class="hidden trait-checkbox" data-item-id="{{trait._id}}" data-binding="data.collapsed" {{ checked trait.data.collapsed }}>
                <div class="trait" data-item-id="{{trait._id}}">
                    <label for="{{trait._id}}-toggle">
                        <h3>
                            {{ trait.name }}
                            <i class="fas fa-trash" data-action="delItem" data-id="{{trait._id}}"></i>
                            <i class="fas fa-edit" data-action="editItem" data-id="{{trait._id}}"></i>
                        </h3>
                    </label>
                    <textarea disabled="disabled">{{trait.data.text}}</textarea>
                </div>
            {{/each}}
        </div>
        <div class="trait-category">
            <h2>Call-on Traits
                <i data-action="addTrait" data-id="call-on" class="fas fa-plus"></i>
            </h2>
            {{#each traits.callon as |trait|}}
            <input type="checkbox" id={{trait._id}}-toggle class="hidden trait-checkbox" data-item-id="{{trait._id}}" data-binding="data.collapsed" {{ checked trait.data.collapsed }}>
                <div class="trait" data-item-id="{{trait._id}}">
                    <label for="{{trait._id}}-toggle">
                        <h3>
                            {{ trait.name }}
                            <i class="fas fa-trash" data-action="delItem" data-id="{{trait._id}}"></i>
                            <i class="fas fa-edit" data-action="editItem" data-id="{{trait._id}}"></i>
                        </h3>
                    </label>
                    <textarea disabled="disabled">{{ trait.data.text }}</textarea>
                </div>
            {{/each}}
        </div>
    </div>

    <input type="checkbox" id="{{actor._id}}-collapseStats" name="data.collapseStats" class="section-collapse stats-collapse" {{ checked data.collapseStats }}>
    <label for="{{actor._id}}-collapseStats" class="section-collapse-label">
        <h2 class="section-header"><i class="fas fa-chevron-down"></i>Stats</h2>
    </label>
    <div class="stats">
        {{> "systems/burningwheel/templates/parts/rollable-item.html" statName="Will" stat=data.will namePrefix="data.will" taxName="data.willTax" taxValue=data.willTax type="stat"}}
        {{> "systems/burningwheel/templates/parts/rollable-item.html" statName="Power" stat=data.power namePrefix="data.power" type="stat"}}
        {{> "systems/burningwheel/templates/parts/rollable-item.html" statName="Agility" stat=data.agility namePrefix="data.agility" type="stat"}}
        {{> "systems/burningwheel/templates/parts/rollable-item.html" statName="Perception" stat=data.perception namePrefix="data.perception" type="stat"}}
        {{> "systems/burningwheel/templates/parts/rollable-item.html" statName="Forte" stat=data.forte namePrefix="data.forte" type="stat"}}
        {{> "systems/burningwheel/templates/parts/rollable-item.html" statName="Speed" stat=data.speed namePrefix="data.speed" type="stat"}}
        <div class="stats-footer flex-row">
            <label>Stride</label><input type="number" placeholder="0" name="data.stride" value="{{data.stride}}">
            <label>Mounted Stride</label><input type="number" placeholder="0" name="data.mountedstride" value="{{data.mountedstride}}">
        </div>
    </div>

    <input type="checkbox" id="{{actor._id}}-collapseAttributes" name="data.collapseAttributes" class="section-collapse attributes-collapse" {{ checked data.collapseAttributes }}>
    <label for="{{actor._id}}-collapseAttributes" class="section-collapse-label">
        <h2 class="section-header"><i class="fas fa-chevron-down"></i>Attributes</h2>
    </label>
    <div class="attributes">
        {{> "systems/burningwheel/templates/parts/rollable-item.html" statName="Health" stat=data.health namePrefix="data.health" routine=true type="attribute"}}
        {{> "systems/burningwheel/templates/parts/rollable-item.html" statName="Steel" stat=data.steel namePrefix="data.steel" routine=true type="attribute"}}
        {{> "systems/burningwheel/templates/parts/rollable-item.html" statName="Circles" stat=data.circles namePrefix="data.circles" routine=true type="circles"}}
        {{> "systems/burningwheel/templates/parts/rollable-item.html" statName="Resources" stat=data.resources namePrefix="data.resources" routine=true  taxName="data.resourcesTax" taxValue=data.resourcesTax type="resources"}}
        {{> "systems/burningwheel/templates/parts/rollable-item.html" statName=data.custom1.name stat=data.custom1 namePrefix="data.custom1" routine=true customName=true type="attribute"}}
        {{> "systems/burningwheel/templates/parts/rollable-item.html" statName=data.custom2.name stat=data.custom2 namePrefix="data.custom2" routine=true customName=true type="attribute"}}
        <div class="attributes-derived">
            <div class="attributes-item flex-row">
                <label class="attribute-label">Reflexes</label>
                <div class="attribute-value">B{{data.reflexesExp}}</div>
            </div>
            <div class="attributes-item flex-row">
                <label class="attribute-label">Mortal Wound</label>
                <div class="attribute-value">B{{data.mortalWound}}</div>
            </div>
            <br/>
            <div class="attributes-item flex-row">
                <label class="debt-label">Cash</label>
                <div class="attribute-text">
                    <input type="number" name="data.cash" value="{{data.cash}}" placeholder="0">
                    Dice
                </div>
            </div>
            <div class="attributes-item flex-row">
                <label class="debt-label">Funds</label>
                <div class="attribute-text">
                    <input type="number" name="data.funds" value="{{data.funds}}" placeholder="0">
                    Dice
                </div>
            </div>
            <div class="attributes-item flex-row">
                <label class="debt-label">Property</label>
                <input type="text" class="attribute-text" name="data.property" value="{{data.property}}">
            </div>
            <div class="attributes-item flex-row">
                <label class="debt-label">Loans</label>
                <input type="text" class="attribute-text" name="data.loans" value="{{data.loans}}">
            </div>
            <div class="attributes-item flex-row">
                <label class="debt-label">Debt</label>
                <input type="text" class="attribute-text" name="data.debt" value="{{data.debt}}">
            </div>
        </div>
        <div class="attributes-debts"></div>
    </div>
    
    <input type="checkbox" id="{{actor._id}}-collapseRelationships" name="data.collapseRelationships" class="section-collapse relationships-collapse" {{ checked data.collapseRelationships }}>
    <label for="{{actor._id}}-collapseRelationships" class="section-collapse-label">
        <h2 class="section-header">
            <i class="fas fa-chevron-down"></i>Relationships & Reputations
        </h2>
    </label>
    <div class="relationship-section flex-row">
        <div class="relationships">
            <h2>Relationships  <i data-action="addRelationship" class="fas fa-plus"></i></h2></i>
            {{#each relationships as |r|}}
                {{> "systems/burningwheel/templates/parts/relationships.html" relationship=r exp=../data.circles.exp}}
            {{/each}}
        </div>
        <div class="reputations">
            <h2>Reputations  <i data-action="addReputation" class="fas fa-plus"></i></h2>
            {{#each reputations as |r|}}
            <div class="reputation flex-row {{r.data.cssClass}}">
                <div class="item-title">
                    {{r.data.dice}}D - {{ r.name }}
                </div>
                <i class="fas fa-edit" data-action="editItem" data-id="{{r._id}}"></i>
                <i class="fas fa-trash" data-action="delItem" data-id="{{r._id}}"></i>
            </div>
            {{/each}}
        </div>
        <div class="affiliations">
            <h2>Affiliations  <i data-action="addAffiliation" class="fas fa-plus"></i></h2>
            {{#each affiliations as |a|}}
            <div class="affiliation flex-row">
                <div class="item-title">
                    {{a.data.dice}}D - {{ a.name }}
                </div>
                <i class="fas fa-edit" data-action="editItem" data-id="{{a._id}}"></i>
                <i class="fas fa-trash" data-action="delItem" data-id="{{a._id}}"></i>
            </div>
            {{/each}}
        </div>
        <hr>
    </div>

    <input type="checkbox" id="{{actor._id}}-collapseGear" name="data.collapseGear" class="section-collapse gear-collapse" {{ checked data.collapseGear }}>
    <label for="{{actor._id}}-collapseGear" class="section-collapse-label">
        <h2 class="section-header"><i class="fas fa-chevron-down"></i>Gear, Posessions, and Property</h2>
    </label>
    <div class="gear item-grid col-4">
        {{#each equipment as |e|}}
        <div class="{{e.data.cssClass}}">
            {{e.name}}
            <i class="fas fa-trash item-action-icon" data-action="delItem" data-id="{{e._id}}"></i>
            <i class="fas fa-edit item-action-icon" data-action="editItem" data-id="{{e._id}}"></i>
        </div>
        {{/each}}
    </div>

    <input type="checkbox" id="{{actor._id}}-collapseMisc" name="data.collapseMisc" class="section-collapse misc-collapse" {{ checked data.collapseMisc }}>
    <label for="{{actor._id}}-collapseMisc" class="section-collapse-label">
        <h2 class="section-header"><i class="fas fa-chevron-down"></i>Notes, Spells and Other Miscellanea</h2>
    </label>
    <div class="misc-section item-grid col-3">
        <textarea name="data.miscNotes1" class="note-box" rows="4">{{data.miscNotes1}}</textarea>
        <textarea name="data.miscNotes2" class="note-box" rows="4">{{data.miscNotes2}}</textarea>
        <textarea name="data.miscNotes3" class="note-box" rows="4">{{data.miscNotes3}}</textarea>
    </div>

    <input type="checkbox" id="{{actor._id}}-collapseSkills" name="data.collapseSkills" class="section-collapse skills-collapse" {{ checked data.collapseSkills }}>
    <label for="{{actor._id}}-collapseSkills" class="section-collapse-label">
        <h2 class="section-header"><i class="fas fa-chevron-down"></i>Skills</h2>
    </label>
    <div class="skills">
        {{#each skills as |skill|}}
            {{> "systems/burningwheel/templates/parts/rollable-skill.html" skill=skill }}
        {{/each}}
    </div>

    <input type="checkbox" id="{{actor._id}}-collapseLearning" name="data.collapseLearning" class="section-collapse learning-collapse" {{ checked data.collapseLearning }}>
    <label for="{{actor._id}}-collapseLearning" class="section-collapse-label">
        <h2 class="section-header"><i class="fas fa-chevron-down"></i>Learning and Practice</h2>
    </label>
    <div class="learning-practice flex-row">
        <div class="flex-row learning-section">
            {{#each learning as |skill|}}
                {{> "systems/burningwheel/templates/parts/learning.html" skill=skill }}
            {{/each}}
        </div>
        <div class="practice-log">
            <div class="add-new-item-label" data-action="learn-skill"><i class="fas fa-plus"></i> Learn New Skill</div>
            <div>Practice Log</div>
            <textarea name="data.practiceLog">{{data.practiceLog}}</textarea>
        </div>
    </div>

    <input type="checkbox" id="{{actor._id}}-collapsePtgs" name="data.collapsePtgs" class="section-collapse ptgs-collapse" {{ checked data.collapsePtgs }}>
    <label for="{{actor._id}}-collapsePtgs" class="section-collapse-label">
        <h2 class="section-header"><i class="fas fa-chevron-down"></i>Injury and Recovery</h2>
    </label>
    <div class="ptgs">
        {{> "systems/burningwheel/templates/parts/ptgs.html" ptgs=data.ptgs id=actor._id }}
    </div>
    <input type="checkbox" id="{{actor._id}}-collapseCombat" name="data.collapseCombat" class="section-collapse combat-collapse" {{ checked data.collapseCombat }}>

    <label for="{{actor._id}}-collapseCombat" class="section-collapse-label">
        <h2 class="section-header"><i class="fas fa-chevron-down"></i>Weapons and Armor</h2>
    </label>
    <div class="combat-section flex-row">
        <div class="weapons">
            {{> "systems/burningwheel/templates/parts/weapons.html" melee=melee ranged=ranged }}
        </div>
        <div class="armor">
            {{> "systems/burningwheel/templates/parts/armor.html" armor=armor }}
        </div>
        <div class="training-skills">
            <hr>
            <h3>Training Skills</h3>
            {{#each training as |t|}}
            <div class="training-skill" data-item-id="{{t._id}}">
                <div class="flex-row">
                    <div class="training-skill-name">{{ t.name }}</div>
                    <i class="fas fa-edit" data-action="editItem" data-id="{{t._id}}"></i>
                    <i class="fas fa-trash" data-action="delItem" data-id="{{t._id}}"></i>
                </div>
            </div>
            {{/each}}
        </div>
        <div class="clumsy-stats">
            <hr>
            <h3>Clumsy Weight Penalties</h3>
            <div class="flex-row">
                <div class="clumsy-item flex-row">
                    <label class="clumsy-label">Agility</label>
                    <div class="clumsy-value">+{{data.clumsyWeight.agilityPenalty}} Ob</div>
                </div>
                <div class="clumsy-item flex-row">
                    <label class="clumsy-label">Speed</label>
                    <div class="clumsy-value">+{{data.clumsyWeight.speedObPenalty}} Ob</div>
                </div>
                <div class="clumsy-item flex-row">
                    <label class="clumsy-label">Speed</label>
                    <div class="clumsy-value">-{{data.clumsyWeight.speedDiePenalty}} Die</div>
                </div>
                <div class="clumsy-item flex-row">
                    <label class="clumsy-label">Climbing</label>
                    <div class="clumsy-value">+{{data.clumsyWeight.climbingPenalty}} Ob</div>
                </div>
                <div class="clumsy-item flex-row">
                    <label class="clumsy-label">Health / Forte</label>
                    <div class="clumsy-value">+{{data.clumsyWeight.healthFortePenalty}} Ob</div>
                </div>
                <div class="clumsy-item flex-row">
                    <label class="clumsy-label">Throwing / Shooting</label>
                    <div class="clumsy-value">+{{data.clumsyWeight.throwingShootingPenalty}} Ob</div>
                </div>
                <div class="clumsy-item flex-row">
                    <label class="clumsy-label">Stealthy</label>
                    <div class="clumsy-value">+{{data.clumsyWeight.stealthyPenalty}} Ob</div>
                </div>
                <div class="clumsy-item flex-row">
                    <label class="clumsy-label">Swimming</label>
                    <div class="clumsy-value">+{{data.clumsyWeight.swimmingPenalty}} Ob</div>
                </div>
                <div class="clumsy-item flex-row">
                    <label class="clumsy-label">Perception / Observation</label>
                    <div class="clumsy-value">+{{data.clumsyWeight.helmetObPenalty}} Ob</div>
                </div>
                {{#unless data.armorTrained}}
                {{#if data.clumsyWeight.untrainedHealth}}
                <div class="clumsy-item flex-row">
                    <label class="clumsy-label">Untrained Health/Forte Penalty</label>
                    <div class="clumsy-value">+{{data.clumsyWeight.untrainedHealth}} Ob</div>
                </div>
                {{/if}}
                {{#if data.clumsyWeight.untrainedAll}}
                <div class="clumsy-item flex-row">
                    <label class="clumsy-label">Untrained Global Penalty</label>
                    <div class="clumsy-value">+{{data.clumsyWeight.untrainedAll}} Ob</div>
                </div>
                {{/if}}
                {{/unless}}
            </div>
        </div>
    </div>
    <hr>
    <div class="footer">
        <span class="footer-left"><a href="https://github.com/StasTserk/foundry-burningwheel/issues/">Report Problem</a></span>
        <span class="footer-center">Sheet Version {{systemVersion}}</span>
        <span class="footer-right">See Release notes <a href="https://github.com/StasTserk/foundry-burningwheel/releases/">on github.</a></span>
    </div>
</form>