<form autocomplete="off" class="character">
    <div class="character-header flex-row">
        <div class="portrait">
            <img class="profile" src="{{actor.img}}" title="{{actor.name}}" data-edit="img"/>
        </div>
        <div class="section-index item-grid col-2">
            <h2 class="section-header">Character Index</h2>
            <div>
                <label for="character-name">Name</label>
                <input id="character-name" type="text" name="name" value="{{actor.name}}">
            </div>
            <div>
                <label for="character-stock">Stock</label>
                <input id="character-stock" type="text" name="data.stock" value="{{data.stock}}">
            </div>
            <div>
                <label for="character-age">Age</label>
                <input id="character-age" type="number" name="data.age" value="{{data.age}}">
            </div>
            <div>
                <label for="character-lifepaths">Lifepaths</label>
                <input id="character-lifepaths" type="text" name="data.lifepathString" value="{{data.lifepathString}}">
            </div>
            <div>
                <label for="character-alias">Alias</label>
                <input id="character-alias" type="text" name="data.alias" value="{{data.alias}}">
            </div>
            <div>
                <label for="character-homeland">Homeland</label>
                <input id="character-homeland" type="text" name="data.homeland" value="{{data.homeland}}">
            </div>
            <div>
                <label for="character-features">Features</label>
                <input id="character-features" type="text" name="data.features" value="{{data.features}}">
            </div>
        </div>
    </div>

    <input type="checkbox" id="collapseBeliefs" name="data.collapseBeliefs" class="section-collapse beliefs-collapse" {{ checked data.collapseBeliefs }}>
    <label for="collapseBeliefs" class="section-collapse-label">
        <h2 class="section-header"><i class="fas fa-chevron-down"></i>Beliefs</h2>
    </label>      
    <div class="beliefs">
        {{#each beliefs as |belief iid|}}
            <div class="bits-item flex-row">
                <div>
                    <div class="bits-item-name">{{belief.name}}</div>
                    F:<input type="checkbox" data-item-id="{{belief._id}}" data-binding="data.fate" {{ checked belief.data.fate }}>
                    P:<input type="checkbox" data-item-id="{{belief._id}}" data-binding="data.persona"  {{ checked belief.data.persona }}>
                    D:<input type="checkbox" data-item-id="{{belief._id}}" data-binding="data.deeds" {{ checked belief.data.deeds }}>
                </div>
                <textarea data-item-id="{{belief._id}}" data-binding="data.text" rows="1">{{belief.data.text}}</textarea>
            </div>
        {{/each}}
    </div>

    <input type="checkbox" id="collapseInstincts" name="data.collapseInstincts" class="section-collapse instincts-collapse" {{ checked data.collapseInstincts }}>
    <label for="collapseInstincts" class="section-collapse-label">
        <h2 class="section-header"><i class="fas fa-chevron-down"></i>Instincts</h2>
    </label>
    <div class="instincts">
        {{#each instincts as |instinct|}}
            <div class="bits-item flex-row">
                <div>
                <div class="bits-item-name">{{instinct.name}}</div>
                    F:<input type="checkbox" data-item-id="{{instinct._id}}" data-binding="instinct.fate" {{ checked instinct.data.fate }}>
                    P:<input type="checkbox" data-item-id="{{instinct._id}}" data-binding="instinct.persona"  {{ checked instinct.data.persona }}>
                    D:<input type="checkbox" data-item-id="{{instinct._id}}" data-binding="instinct.deeds" {{ checked instinct.data.deeds }}>
                </div>
                <textarea data-item-id="{{instinct._id}}" data-binding="data.text" rows="1">{{instinct.data.text}}</textarea>
            </div>
        {{/each}}
    </div>

    <input type="checkbox" id="collapseTraits" name="data.collapseTraits" class="section-collapse traits-collapse" {{ checked data.collapseTraits }}>
    <label for="collapseTraits" class="section-collapse-label">
        <h2 class="section-header"><i class="fas fa-chevron-down"></i>Traits</h2>
    </label>
    <div class="traits flex-row">
        <div class="trait-category">
            <h2>Character Traits
                <i data-action="addTrait" data-id="character" class="fas fa-plus"></i>
            </h2>
            {{#each traits.character as |trait|}}
                <div class="trait" data-item-id="{{trait._id}}">
                    <h3>
                        {{ trait.name }}
                        <i class="fas fa-trash" data-action="delItem" data-id="{{trait._id}}"></i>
                        <i class="fas fa-edit" data-action="editItem" data-id="{{trait._id}}"></i>
                    </h3>
                </div>
            {{/each}}
        </div>
        <div class="trait-category">
            <h2>Die Traits
                <i data-action="addTrait" data-id="die" class="fas fa-plus"></i>
            </h2>
            {{#each traits.die as |trait|}}
                <input type="checkbox" id={{trait._id}}-toggle class="hidden trait-checkbox" data-item-id="{{trait._id}}" data-binding="data.collapsed" {{ checked trait.data.collapsed }}>
                <div class="trait" data-item-id="{{trait._id}}">
                    <label for="{{trait._id}}-toggle">
                        <h3>
                            {{ trait.name }}
                            <i class="fas fa-trash" data-action="delItem" data-id="{{trait._id}}"></i>
                            <i class="fas fa-edit" data-action="editItem" data-id="{{trait._id}}"></i>
                        </h3>
                    </label>
                    <textarea disabled="disabled">{{trait.data.text}}</textarea>
                </div>
            {{/each}}
        </div>
        <div class="trait-category">
            <h2>Call-on Traits
                <i data-action="addTrait" data-id="call-on" class="fas fa-plus"></i>
            </h2>
            {{#each traits.callon as |trait|}}
            <input type="checkbox" id={{trait._id}}-toggle class="hidden trait-checkbox" data-item-id="{{trait._id}}" data-binding="data.collapsed" {{ checked trait.data.collapsed }}>
                <div class="trait" data-item-id="{{trait._id}}">
                    <label for="{{trait._id}}-toggle">
                        <h3>
                            {{ trait.name }}
                            <i class="fas fa-trash" data-action="delItem" data-id="{{trait._id}}"></i>
                            <i class="fas fa-edit" data-action="editItem" data-id="{{trait._id}}"></i>
                        </h3>
                    </label>
                    <textarea disabled="disabled">{{ trait.data.text }}</textarea>
                </div>
            {{/each}}
        </div>
    </div>

    <input type="checkbox" id="collapseStats" name="data.collapseStats" class="section-collapse stats-collapse" {{ checked data.collapseStats }}>
    <label for="collapseStats" class="section-collapse-label">
        <h2 class="section-header"><i class="fas fa-chevron-down"></i>Stats</h2>
    </label>
    <div class="stats">
        {{> "systems/burningwheel/templates/parts/rollable-item.html" statName="Will" stat=data.will namePrefix="data.will" taxName="data.willTax" taxValue=data.willTax type="stat"}}
        {{> "systems/burningwheel/templates/parts/rollable-item.html" statName="Power" stat=data.power namePrefix="data.power" type="stat"}}
        {{> "systems/burningwheel/templates/parts/rollable-item.html" statName="Agility" stat=data.agility namePrefix="data.agility" type="stat"}}
        {{> "systems/burningwheel/templates/parts/rollable-item.html" statName="Perception" stat=data.perception namePrefix="data.perception" type="stat"}}
        {{> "systems/burningwheel/templates/parts/rollable-item.html" statName="Forte" stat=data.forte namePrefix="data.forte" type="stat"}}
        {{> "systems/burningwheel/templates/parts/rollable-item.html" statName="Speed" stat=data.speed namePrefix="data.speed" type="stat"}}
    </div>

    <input type="checkbox" id="collapseAttributes" name="data.collapseAttributes" class="section-collapse attributes-collapse" {{ checked data.collapseAttributes }}>
    <label for="collapseAttributes" class="section-collapse-label">
        <h2 class="section-header"><i class="fas fa-chevron-down"></i>Attributes</h2>
    </label>
    <div class="attributes">
        {{> "systems/burningwheel/templates/parts/rollable-item.html" statName="Health" stat=data.health namePrefix="data.health" routine=true type="attribute"}}
        {{> "systems/burningwheel/templates/parts/rollable-item.html" statName="Steel" stat=data.steel namePrefix="data.steel" routine=true type="attribute"}}
        {{> "systems/burningwheel/templates/parts/rollable-item.html" statName="Circles" stat=data.circles namePrefix="data.circles" routine=true type="circles"}}
        {{> "systems/burningwheel/templates/parts/rollable-item.html" statName="Resources" stat=data.resources namePrefix="data.resources" routine=true  taxName="data.resourcesTax" taxValue=data.resourcesTax type="resources"}}
        {{> "systems/burningwheel/templates/parts/rollable-item.html" statName=data.custom1.name stat=data.custom1 namePrefix="data.custom1" routine=true customName=true type="attribute"}}
        {{> "systems/burningwheel/templates/parts/rollable-item.html" statName=data.custom2.name stat=data.custom2 namePrefix="data.custom2" routine=true customName=true type="attribute"}}
        <div class="attributes-derived">
            <div class="attributes-item flex-row">
                <label class="attribute-label">Reflexes</label>
                <div class="attribute-value">B{{data.reflexesExp}}</div>
            </div>
            <div class="attributes-item flex-row">
                <label class="attribute-label">Mortal Wound</label>
                <div class="attribute-value">B{{data.mortalWound}}</div>
            </div>
            <br/>
            <div class="attributes-item flex-row">
                <label class="debt-label">Cash</label>
                <input type="text" class="attribute-text" name="data.cash" value="{{data.cash}}">
            </div>
            <div class="attributes-item flex-row">
                <label class="debt-label">Funds</label>
                <input type="text" class="attribute-text" name="data.funds" value="{{data.funds}}">
            </div>
            <div class="attributes-item flex-row">
                <label class="debt-label">Property</label>
                <input type="text" class="attribute-text" name="data.property" value="{{data.property}}">
            </div>
            <div class="attributes-item flex-row">
                <label class="debt-label">Loans</label>
                <input type="text" class="attribute-text" name="data.loans" value="{{data.loans}}">
            </div>
            <div class="attributes-item flex-row">
                <label class="debt-label">Debt</label>
                <input type="text" class="attribute-text" name="data.debt" value="{{data.debt}}">
            </div>
        </div>
        <div class="attributes-debts"></div>
    </div>
    
    <input type="checkbox" id="collapseRelationships" name="data.collapseRelationships" class="section-collapse relationships-collapse" {{ checked data.collapseRelationships }}>
    <label for="collapseRelationships" class="section-collapse-label">
        <h2 class="section-header">
            <i class="fas fa-chevron-down"></i>Relationships & Reputations
        </h2>
    </label>
    <div class="relationship-section flex-row">
        <div class="relationships">
            <h2>Relationships  <i data-action="addRelationship" class="fas fa-plus"></i></h2></i>
            {{#each relationships as |r|}}
                {{> "systems/burningwheel/templates/parts/relationships.html" relationship=r exp=../data.circles.exp}}
            {{/each}}
        </div>
        <div class="reputations">
            <h2>Reputations</h2>
        </div>
        <div class="affiliations">
            <h2>Affiliations</h2>
        </div>
        <hr>
    </div>

    <input type="checkbox" id="collapseGear" name="data.collapseGear" class="section-collapse gear-collapse" {{ checked data.collapseGear }}>
    <label for="collapseGear" class="section-collapse-label">
        <h2 class="section-header"><i class="fas fa-chevron-down"></i>Gear, Posessions, and Property</h2>
    </label>
    <div class="gear item-grid col-4">
        {{#each equipment as |e|}}
        <div class="{{e.data.cssClass}}">
            {{e.name}}
            <i class="fas fa-trash item-action-icon" data-action="delItem" data-id="{{e._id}}"></i>
            <i class="fas fa-edit item-action-icon" data-action="editItem" data-id="{{e._id}}"></i>
        </div>
        {{/each}}
    </div>

    <input type="checkbox" id="collapseMisc" name="data.collapseMisc" class="section-collapse misc-collapse" {{ checked data.collapseMisc }}>
    <label for="collapseMisc" class="section-collapse-label">
        <h2 class="section-header"><i class="fas fa-chevron-down"></i>Notes, Spells and Other Miscellanea</h2>
    </label>
    <div class="misc-section item-grid col-3">
        <textarea name="data.miscNotes1" class="note-box" rows="4">{{data.miscNotes1}}</textarea>
        <textarea name="data.miscNotes2" class="note-box" rows="4">{{data.miscNotes2}}</textarea>
        <textarea name="data.miscNotes3" class="note-box" rows="4">{{data.miscNotes3}}</textarea>
    </div>

    <input type="checkbox" id="collapseSkills" name="data.collapseSkills" class="section-collapse skills-collapse" {{ checked data.collapseSkills }}>
    <label for="collapseSkills" class="section-collapse-label">
        <h2 class="section-header"><i class="fas fa-chevron-down"></i>Skills</h2>
    </label>
    <div class="skills">
        {{#each skills as |skill|}}
            {{> "systems/burningwheel/templates/parts/rollable-skill.html" skill=skill }}
        {{/each}}
    </div>

    <input type="checkbox" id="collapseLearning" name="data.collapseLearning" class="section-collapse learning-collapse" {{ checked data.collapseLearning }}>
    <label for="collapseLearning" class="section-collapse-label">
        <h2 class="section-header"><i class="fas fa-chevron-down"></i>Learning and Practice</h2>
    </label>
    <div class="learning-practice flex-row">
        <div class="flex-row learning-section">
            {{#each training as |skill|}}
                {{> "systems/burningwheel/templates/parts/learning.html" skill=skill }}
            {{/each}}
        </div>
        <div class="practice-log">
            <div>Practice Log</div>
            <textarea name="data.practiceLog">{{data.practiceLog}}</textarea>
        </div>
    </div>

    <input type="checkbox" id="collapsePtgs" name="data.collapsePtgs" class="section-collapse ptgs-collapse" {{ checked data.collapsePtgs }}>
    <label for="collapsePtgs" class="section-collapse-label">
        <h2 class="section-header"><i class="fas fa-chevron-down"></i>Injury and Recovery</h2>
    </label>
    <div class="ptgs">
        {{> "systems/burningwheel/templates/parts/ptgs.html" ptgs=data.ptgs }}
    </div>
    <input type="checkbox" id="collapseCombat" name="data.collapseCombat" class="section-collapse combat-collapse" {{ checked data.collapseCombat }}>

    <label for="collapseCombat" class="section-collapse-label">
        <h2 class="section-header"><i class="fas fa-chevron-down"></i>Weapons and Armor</h2>
    </label>
    <div class="combat-section flex-row">
        <div class="weapons">
            {{> "systems/burningwheel/templates/parts/weapons.html" melee=melee ranged=ranged }}
        </div>
        <div class="armor">
            {{> "systems/burningwheel/templates/parts/armor.html" armor=armor }}
        </div>
    </div>
</form>