<form class="flex-row" autocomplete="off">
    {{log this}}
    {{#if gmView}}
    <div class="control-grid">
        <button class="control-button" data-action="clearAll">Clear All</button>
        <button class="control-button" data-action="resetRound">Reset Round</button>
    </div>
    {{/if}}
    <div class="fighters-grid">
        <div class="participant-card">
            Participant
        </div>
        <div class="volley">
            Volley 1
        </div>
        <div class="volley">
            Volley 2
        </div>
        <div class="volley">
            Volley 3
        </div>
        {{#each participants as |p i|}}
        <div class="participant-card">
            {{#if ../gmView}}
            <button data-action="removeFighter" data-index="{{i}}" class="remove-fighter-button"><i class="fas fa-times-circle"></i></button>
            {{/if}}
            <div class="actor-name" data-action="toggleHidden" data-index="{{i}}">{{p.name}}</div>
            {{#if p.showActions}}
            <img class="portrait" src="{{p.imgSrc}}" title="{{p.name}}" data-action="openSheet" data-actor-id="{{p.id}}"/>
            <div class="details">
                <div>
                    Reflexes: {{p.reflexes}}
                </div>
                <div>
                    Engagement Bonus
                    <input data-index="{{i}}" name="engagementBonus" type="number" class="exponent no-arrows" value="{{p.engagementBonus}}">
                </div>
                <div>
                    Position Penalty
                    <input data-index="{{i}}" name="positionPenalty" type="number" class="exponent no-arrows" value="{{p.positionPenalty}}">
                </div>
                <div>
                    Active Weapon
                    <select data-index="{{i}}" name="weaponId">
                        {{#select p.weaponId}}
                        <option value="">Pick a Weapon</option>
                        {{#each p.weapons as |s|}}
                        <option value="{{s.id}}">{{s.label}}</option>
                        {{/each}}
                        {{/select}}
                    </select>
                </div>
            </div>
            <button class="control-button" data-index="{{i}}" data-action="rollSpeed">Test Speed</button>
            <button class="control-button" data-index="{{i}}" data-action="rollPower">Test Power</button>
            <button class="control-button" data-index="{{i}}" data-action="rollAgility">Test Agility</button>
            <button class="control-button" data-index="{{i}}" data-action="rollSkill">Test Skill</button>
            {{/if}}
        </div>
        <div class="volley">
            {{#if p.showActions}}
            <label>Action 1
                <select name="action1" data-index="{{i}}">
                    {{#select p.action1}}
                    <option value="">Do Nothing</option>
                    {{#each ../actionOptions as |ao|}}
                    <optgroup label="{{@key}}">
                        {{#each ao as |o|}}
                        <option value="{{o}}">{{o}}</option>
                        {{/each}}
                    </optgroup>
                    {{/each}}
                    {{/select}}
                </select>
            </label>
            {{#if p.showAction2}}
            <label>Action 2
                <select name="action2" data-index="{{i}}">
                    {{#select p.action2}}
                    <option value="">Do Nothing</option>
                    {{#each ../actionOptions as |ao|}}
                    <optgroup label="{{@key}}">
                        {{#each ao as |o|}}
                        <option value="{{o}}">{{o}}</option>
                        {{/each}}
                    </optgroup>
                    {{/each}}
                    {{/select}}
                </select>
            </label>
            {{/if}}
            {{#if p.showAction3}}
            <label>Action 3
                <select name="action3" data-index="{{i}}">
                    {{#select p.action3}}
                    <option value="">Do Nothing</option>
                    {{#each ../actionOptions as |ao|}}
                    <optgroup label="{{@key}}">
                        {{#each ao as |o|}}
                        <option value="{{o}}">{{o}}</option>
                        {{/each}}
                    </optgroup>
                    {{/each}}
                    {{/select}}
                </select>
            </label>
            {{/if}}
            {{/if}}
        </div>
        <div class="volley">
            {{#if p.showActions}}
            <label>Action 1
                <select name="action4" data-index="{{i}}">
                    {{#select p.action4}}
                    <option value="">Do Nothing</option>
                    {{#each ../actionOptions as |ao|}}
                    <optgroup label="{{@key}}">
                        {{#each ao as |o|}}
                        <option value="{{o}}">{{o}}</option>
                        {{/each}}
                    </optgroup>
                    {{/each}}
                    {{/select}}
                </select>
            </label>
            {{#if p.showAction5}}
            <label>Action 2
                <select name="action5" data-index="{{i}}">
                    {{#select p.action5}}
                    <option value="">Do Nothing</option>
                    {{#each ../actionOptions as |ao|}}
                    <optgroup label="{{@key}}">
                        {{#each ao as |o|}}
                        <option value="{{o}}">{{o}}</option>
                        {{/each}}
                    </optgroup>
                    {{/each}}
                    {{/select}}
                </select>
            </label>
            {{/if}}
            {{#if p.showAction6}}
            <label>Action 3
                <select name="action6" data-index="{{i}}">
                    {{#select p.action6}}
                    <option value="">Do Nothing</option>
                    {{#each ../actionOptions as |ao|}}
                    <optgroup label="{{@key}}">
                        {{#each ao as |o|}}
                        <option value="{{o}}">{{o}}</option>
                        {{/each}}
                    </optgroup>
                    {{/each}}
                    {{/select}}
                </select>
            </label>
            {{/if}}
            {{/if}}
        </div>
        <div class="volley">
            {{#if p.showActions}}
            <label>Action 1
                <select name="action7" data-index="{{i}}">
                    {{#select p.action7}}
                    <option value="">Do Nothing</option>
                    {{#each ../actionOptions as |ao|}}
                    <optgroup label="{{@key}}">
                        {{#each ao as |o|}}
                        <option value="{{o}}">{{o}}</option>
                        {{/each}}
                    </optgroup>
                    {{/each}}
                    {{/select}}
                </select>
            </label>
            {{#if p.showAction8}}
            <label>Action 2
                <select name="action8" data-index="{{i}}">
                    {{#select p.action8}}
                    <option value="">Do Nothing</option>
                    {{#each ../actionOptions as |ao|}}
                    <optgroup label="{{@key}}">
                        {{#each ao as |o|}}
                        <option value="{{o}}">{{o}}</option>
                        {{/each}}
                    </optgroup>
                    {{/each}}
                    {{/select}}
                </select>
            </label>
            {{/if}}
            {{#if p.showAction9}}
            <label>Action 3
                <select name="action9" data-index="{{i}}">
                    {{#select p.action9}}
                    <option value="">Do Nothing</option>
                    {{#each ../actionOptions as |ao|}}
                    <optgroup label="{{@key}}">
                        {{#each ao as |o|}}
                        <option value="{{o}}">{{o}}</option>
                        {{/each}}
                    </optgroup>
                    {{/each}}
                    {{/select}}
                </select>
            </label>
            {{/if}}
            {{/if}}
        </div>
        {{/each}}
        {{#if gmView}}
        <div class="newParticipant">
            <select name="newParticipant">
                <option value="">Add a new fighter.</option>
                {{#each participantOptions}}
                <option value="{{this.id}}">{{this.name}}</option>
                {{/each}}
            </select>
        </div>
        {{/if}}
    </div>
</form>